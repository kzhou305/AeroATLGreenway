<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AeroATL Greenway Plan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
    <script src="./lib/nice-select2-2.0.0/dist/js/nice-select2.js"></script>
    <link rel="stylesheet" href="./lib/nice-select2-2.0.0/dist/css/nice-select2.css"/>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

      h1 {
        font-size: 20px;
      }

      h2 {
        font-size: 16px;
        line-height: 20px;
        margin-bottom: 10px;
      }

      a {
        text-decoration: none;
        color: #FFB24A 
;
      }

      #console {
        position: absolute;
        margin: 10px;
        width: 260px;
        background-color: white;
        padding: 10px;
        right: 0px;
      }

      .session {
        margin-bottom: 20px;
      }

      .session2 {
        margin-bottom: 10px;
      }

      #legend div span {
        border-radius: 50%;
        display: inline-block;
        height: 10px;
        margin-right: 5px;
        width: 10px;
      }

      .label {
        width: 15%;
        display: inline-block;
        text-align: left;
      }

      .mapboxgl-popup-content {
        padding: 10px;
        line-height: 1.5;
        max-width: 2000px;
      }

      .mapboxgl-popup-tip {
        display: none;
      }

    </style>
  </head>

  <body>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css" type="text/css">
    <div id="map"></div>
    <p style="font-style: italic; position: absolute; left: 100px; bottom: 25px; font-size: 12px">Map by Xiaofan Liang, Georgia Tech</p> 
    <div id="console">
      <h1>AeroATL Greenway Plan</h1>
      <p>
        Explore how your trips may be impacted by AeroATL Greenway Plan! 
        <a
          href="https://aeroatl.org/special-projects/aeroatl-greenway-model-mile/"
          >Learn more about this project here.</a
        > 
      </p>
      <div class="session">
        <h2>Show AeroATL Greenway Plan Layer(s)</h2> 
        <select id="selectLayer">
          <option selected="selected">All</option>
          <option>Existing Bike Paths</option>
          <option>Model Miles</option>
          <option>Priority Network</option>
          <option>Loop Connecting Downtowns</option>
          <option>Airport Loop</option>
          <option>Outer Ring</option>
          <option>Local Connections</option>
        </select>
      </div>
      <div id="legend", class="session">
<!--         <h2>AeroATL Greenway Plan Segment by Color</h2>
        <div><span style="background-color: #000101"></span>Model Miles</div>
        <div><span style="background-color: #181B18"></span>Priority Network</div>
        <div><span style="background-color: #424146"></span>Loop Connecting Downtowns</div>
        <div><span style="background-color: #61676C"></span>Airport Loop</div>
        <div><span style="background-color: #818285"></span>Outer Ring</div>
        <div><span style="background-color: #B4B1AF"></span>Local Connections</div> -->
        <h2>Building Types by Color</h2>
        <div><span style="background-color: #5B5558"></span>Airport</div>
        <div><span style="background-color: #9B959D"></span>Infrastructure</div>
        <div><span style="background-color: #890B24"></span>Residence</div>
        <div><span style="background-color: #CB4700"></span>Commerce</div>
        <div><span style="background-color: #FE9C2D"></span>Hotel</div>
        <div><span style="background-color: #0E7C33"></span>Recreation</div>
        <div><span style="background-color: #3C9493"></span>Industry</div>
        <div><span style="background-color: #072C83"></span>Office</div>
        <div><span style="background-color: #2F6BA7"></span>Institution</div>
        <div><span style="background-color: #6DA8D6"></span>School</div>
      </div>
    </div>
    <script>
      //reference: https://docs.mapbox.com/help/tutorials/show-changes-over-time/
      //https://docs.mapbox.com/mapbox-gl-js/example/filter-features-within-map-view/
      //https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/
      //https://docs.mapbox.com/mapbox-gl-js/example/popup/
      //https://codepen.io/ZondaDesign/pen/xxVxZVR //toggle layer

      mapboxgl.accessToken = 'pk.eyJ1IjoieHhmZmxsIiwiYSI6ImNsZmtoY3YzbDAwdng0NG1yOXVqYmFveW4ifQ._VjRhEILbOSWgFVR8dtmSw';
      var map = new mapboxgl.Map({
          container: 'map', // container ID
          style: 'mapbox://styles/mapbox/light-v10', // style URL //dark-v10
          center: [-84.4, 33.64], // starting position [lng, lat]
          zoom: 11.5 // starting zoom
      });

      // Create a popup, but don't add it to the map yet.
      const popup = new mapboxgl.Popup({
        closeButton: true
      });

      map.on('load', () => {

        Promise.all([
          fetch('data/Building_mapbox.geojson').then(response => response.json()),
          fetch('data/Greenway_mapbox.geojson').then(response => response.json())
        ])
        .then(([buildingData, greenwayData]) => {
            //console.log(greenwayData.features[535].properties)
            map.addSource('building', {
              type: 'geojson',
              data: buildingData
            });

            map.addSource('greenway', {
              type: 'geojson',
              data: greenwayData
            });

            map.addLayer({
              id: 'building-layer',
              type: 'fill',
              source: 'building',
              paint: {
                'fill-opacity': 0.3,
                'fill-color': [
                  'match',
                  ['get', 'LU4Vis'],
                  'Airport', '#5B5558',
                  'Infrastructure', '#9B959D',
                  'Commerce', '#CB4700',
                  'Hotel', '#FE9C2D',
                  'Recreation', '#0E7C33',
                  'Office', '#072C83',
                  'Institution', '#2F6BA7',
                  'School', '#6DA8D6',
                  'Residence', '#890B24',
                  'Industry', '#3C9493',
                  '#F9F8F8'
                  ]
              }
            });

            map.addLayer({
              id: 'greenway-layer',
              type: 'line',
              source: 'greenway',
              paint: {
                'line-width': 2,
                'line-opacity': 0.8,
                'line-color': '#000101'
                // [
                //   'match',
                //   ['get', 'AeroATL'],
                //   'Model Miles', '#000101',
                //   'Priority Network', '#181B18',
                //   'Loop Connecting Downtowns', '#424146',
                //   'Airport Loop', '#61676C',
                //   'Outer Ring', '#818285',
                //   'Local Connections', '#B4B1AF',
                //   '#F9F8F8'
                // ]
              }
            });

            map.on('mouseenter', 'building-layer', (e) => { //mousemove
            // Change the cursor style as a UI indicator.
            map.getCanvas().style.cursor = 'pointer'; 
            // Populate the popup and set its coordinates based on the feature.
            const feature = e.features[0];
            popup
              //.setLngLat(e.lngLat) //for click
              .setLngLat(e.lngLat)
              .setHTML(
              `<p style='margin:0'><b>Zoning Code:</b> ${feature.properties.Zn_ClsC}</p>
               <p style='margin:0'><b>Land Use Code:</b> ${feature.properties.LUCode}</p>
               <p style='margin:0'><b>Land Use Type:</b> ${feature.properties.LUDes}</p>
               <p style='margin:0'><b>Land Use Vis:</b> ${feature.properties.LU4Viz}</p>
               <p style='margin:0'><b>Estimated Jobs:</b> ${feature.properties.BldgJobs}</p>
               <p style='margin:0'><b>Est. Jobs $3333+:</b> ${feature.properties.Jobs3333}</p>`
              )
              .addTo(map);

            //const popupElem = popup.getElement();
            //popupElem.style.border = `2px solid ${feature.properties.f > 50 ? '#800526':'#FFB24A'}`;
            });
               
            map.on('mouseleave', 'building-layer', () => {
              map.getCanvas().style.cursor = '';
              popup.remove();
            });

            document
              .getElementById('selectLayer')
              .addEventListener('change', (event) => {
                const GreenwayLayer = event.target.value;
                console.log(GreenwayLayer)
                // update the map filter
                //map.setFilter('greenway-layer', ['==', 'AeroATL', GreenwayLayer])
                if(GreenwayLayer == 'All') {
                  map.setFilter('greenway-layer', ['!=', 'AeroATL', ''])
                } else {
                  map.setFilter('greenway-layer', ['==', 'AeroATL', GreenwayLayer]);
                }
                
              });
          });
      });

      //https://github.com/mapbox/mapbox-gl-directions/blob/master/API.md#mapboxdirections
      map.addControl(
        new MapboxDirections({
          accessToken: mapboxgl.accessToken,
          profile: "mapbox/walking",
          controls: {
            instructions: false
          }
        }),
        'top-left'
      );

    </script>
  </body>
</html>
